from pydantic import BaseModel
from typing import Optional


class BiomechElbowModel(BaseModel):
    peak_extension_angle_deg: Optional[float] = None
    peak_extension_frame: Optional[int] = None
    uah_angle_deg: Optional[float] = None
    uah_frame: Optional[int] = None
    release_angle_deg: Optional[float] = None
    release_frame_reported: Optional[int] = None
    """
    Elbow kinematics around the critical window (UAH → Release).
    All angles in degrees.
    """
    uah_angle: float
    release_angle: float

    extension_deg: float              # final usable extension
    extension_raw_deg: Optional[float] = None
    extension_error_margin_deg: Optional[float] = None
    extension_note: Optional[str] = None


class BiomechReleaseHeightModel(BaseModel):
    """
    Normalized release height.
    norm_height > 0  → above shoulder line
    norm_height ~ 0  → shoulder level
    norm_height < 0  → below shoulder line
    """
    norm_height: float
    wrist_y: float


class BiomechModel(BaseModel):
    elbow: Optional[BiomechElbowModel] = None
    release_height: Optional[BiomechReleaseHeightModel] = None

    elbow_conf: Optional[int] = None
    release_height_conf: Optional[int] = None

    angle_plane: Optional[dict] = None

    error: Optional[str] = None

